language: generic

env:
  global:
    - CONDA_PY=3.5
    #  the following key was generated in 2 steps based on the example here https://github.com/quantopian/zipline/blob/master/.travis.yml
    # ANACONDA_TOKEN
    - secure: "LbdHrvf1y+B/pOSqbM5z3FJa6hHbja1zLP3lp7Wbh/9RMua65FoSj+yXiULi0zLmLT1fTEuDKdWkHXgFiWyIawN5Wb/xBNc7UuJi5L2ko0WPs0UxUn6/vzj+rdmAp7lLSJldELWTyDUpnactkLD/HO43LwKW7IGsXas6U1gzjws9LlX4RoAAGfRyPalSWDEA6+/AYmpofmBNCgktqdmDi+zq5wif9X7JTPtVMllW81NLSQqzJvSYzT6EyONFLTJh8bd9FzOeyrR90MahQo8HjVSXAA0yp1qxJGtJtlRLaMIr+Xz7sec/rfIjvT8Vob8ZeAas38uuU5mAg4UgUTidQRYwZZIv4V0dFIY8eMhSruSTP6vReewT2nGSDwGVhENoW+JFVZj2BQ92t81ml6FGhMN/03nrUd7FqH6/W30AjwqAXtYa6GKM3qcMPu1gPr25Y6D8Z1ybYaCkWaD5gRZTc2G67cb1TBxzh3scgMPuJtxYidPLPAjMXy2uFKOrV6o0ZCCztT3TOWUhQ2XQHRpj5hGsjIMWH6zcPHavAcYJZ2xSROkXrSlNyFluSlKnhl2Ix1EjvUYII60cHwIlqc7HprjNp4CsUBdmBWWy7A176Ph6oMuKvf535J27BNKViVOWYHxIx7O8MBP/MxMDHCSHyqedOcwwj6dEI/mSAC3chnU="
    - FTP_USER=dedop
    # FTP_PASSWORD
    - secure: "ELsafkZM8W0tn+YLctiTJE5QvlxrxRlwFCFK8R/uy+9cf6IHB9k7cqupVu+jel7cJAoMIbdA/JiycAmXyMOfbHlQT39VKE8w2FT0PLSA1z1Xk4GuYNFfSBaevkt/IsnTJr+EQ4z9ba5evlso02btW7X7VBCMorepcDxPjeVXyZiYL0QL+QzgqNT3L80V0CNVWDkGQkzzaxBffoq4Q3kOtCTtnaUkuyw7RW7PPs2o561aiFJnEdjkgfSVqnYXr05GSobJznyVqIrxdO+ByWolsEYQukX19RTSC7LL0QrdBXhOVEy6EIfQlbi58yylYI9nu7LFQV7C2ZvhggJ2Twj2y9i//xf/kVfaW5xj0zH6Y6Eq9tBBK4pJJsj9iKX49b14PJJT9EubTS82uY8uJCKlS5EEWBQRA2FbKTjWGtc2ZKtL/kJEEf96jBQjDrYNas39hCnqs1blJ6hSvzv6NxXN8Cn+GM2BfVW+JWLt5W3dorBaVJBNMBhvPMGVqzLNZkrt9l2kHhiOJX4MxYlcRHUK2XTfRUNw4lOvFgsaGVyvbKrO0ppSqkNXdZNassTblfRFO30jjI0i0j8RaBQFpxpqL3bL1Rf522E2zwq/BmOlTgITNo0ovyE1/mzvNdjfY7x10QMhka7OUoxf0jPRnlGucaPJVkGWAl2dn2cXhi09YfQ="
    - INSTALLER_VERSION="0.5.4.dev1"

os:
  - linux
  - osx

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh;
    else
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    fi
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  # Useful for debugging any issues with conda
  - conda info -a
  - conda install conda-build anaconda-client
  - conda create -q -n constructor-environment python=$CONDA_PY constructor
  - source activate constructor-environment

script:
  - conda build -c ccitools recipe
  - constructor installer

after_success:
  - RECIPE_OUTPUT=$(conda build -c ccitools recipe --output)
  - INSTALLER_FILE=DeDop*.sh
  - anaconda -v -t $ANACONDA_TOKEN upload "$RECIPE_OUTPUT" -u dedop --force
  - anaconda -v -t $ANACONDA_TOKEN upload --user dedop --package dedop-installer --package-type file --version $INSTALLER_VERSION $INSTALLER_FILE --force
  - "curl --ftp-create-dirs -T $INSTALLER_FILE -u $FTP_USER:$FTP_PASSWORD ftp://ftp.brockmann-consult.de/$TRAVIS_OS_NAME"
